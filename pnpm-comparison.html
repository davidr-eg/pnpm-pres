<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNPM - Performant Package Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <section class="title-section">
        <div class="title-content">
            <h1 class="main-title">PNPM</h1>
            <h3 class="subtitle">Performant Node Package Manager - Recommended for Adoption (Tech Radar 2025)</h3>
            
            <div class="benefits">
                <div class="benefit">
                    <h4 class="benefit-title">Fast</h4>
                    <p class="benefit-description">"pnpm is up to 2x faster than npm"</p>
                    <p class="benefit-description"><b>Current project:</b> npm: 23s | pnpm: 6s/4s</p>
                </div>
                <div class="benefit">
                    <h4 class="benefit-title">Small</h4>
                    <p class="benefit-description">Shared package directory prevents duplicates on your machine</p>
                </div>
                <div class="benefit">
                    <h4 class="benefit-title">Strict</h4>
                    <p class="benefit-description">Prevents "phantom dependencies"<br>Only explicitly declared packages can be imported</p>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <h1>Dependency Structure Comparison</h1>
        
        <div class="description">
            <p>Traditional <b>npm</b> (v3+) and <b>yarn</b> create a flat structure where dependencies get "hoisted" to the top-level <code>node_modules</code> folder. This means if your project depends on package A, and package A depends on package B, both A and B end up at the same level in <code>node_modules</code>.</p>
            <p><b>pnpm</b> instead creates a nested structure using a two-layer linking system. Your code uses symlinks to access a hidden <code>.pnpm</code> folder with a precise structure that mirrors the dependency tree. This <code>.pnpm</code> folder then uses hard links to a global content-addressable store (<code>~/.pnpm-store/</code>), so actual package files only exist once on your machine.</p>
        </div>
        
        <div class="comparison">
            <!-- npm/yarn Column -->
            <div class="package-manager">
                <div class="pm-title npm-title">
                    npm / yarn
                    <span class="badge">Flat Structure</span>
                </div>
                
                <div class="structure">
                    <div class="folder-name">
                        <span class="icon folder-icon"></span>
                        <strong>node_modules/</strong>
                    </div>
                    <div class="folder">
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">express/</span>
                            <span class="arrow">‚Üê actual files</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">cookie/</span>
                            <span class="arrow">‚Üê hoisted!</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">react/</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">lodash/</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">webpack/</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="phantom">mime-types/</span>
                            <span class="arrow">‚Üê phantom dep!</span>
                        </div>
                    </div>
                </div>
                
                <div class="warning">
                    ‚ö†Ô∏è <strong>Phantom Dependencies:</strong> Your code can import 'cookie' and 'mime-types' even though they're not in package.json
                </div>
                
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">~250MB</div>
                        <div class="stat-label">Per Project</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">2.5GB</div>
                        <div class="stat-label">10 Projects</div>
                    </div>
                </div>
                
                <div class="structure">
                    <strong>If you have 3 projects using React:</strong>
                    <div class="folder">
                        <div class="folder-name">
                            <span class="icon folder-icon"></span>
                            project1/node_modules/react/ <span class="actual-file">17MB</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon folder-icon"></span>
                            project2/node_modules/react/ <span class="actual-file">17MB</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon folder-icon"></span>
                            project3/node_modules/react/ <span class="actual-file">17MB</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; color: #dc3545;">
                        Total: 51MB for the same package! üî¥
                    </div>
                </div>
            </div>
            
            <!-- pnpm Column -->
            <div class="package-manager">
                <div class="pm-title pnpm-title">
                    pnpm
                    <span class="badge">Non-flat + Links</span>
                </div>
                
                <div class="structure">
                    <div class="folder-name">
                        <span class="icon folder-icon"></span>
                        <strong>node_modules/</strong>
                    </div>
                    <div class="folder">
                        <div class="folder-name">
                            <span class="icon link-icon"></span>
                            <span class="symlink">express/</span>
                            <span class="arrow">‚Üí .pnpm/express@4.18.0/...</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon link-icon"></span>
                            <span class="symlink">react/</span>
                            <span class="arrow">‚Üí .pnpm/react@18.2.0/...</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon link-icon"></span>
                            <span class="symlink">webpack/</span>
                            <span class="arrow">‚Üí .pnpm/webpack@5.89.0/...</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon folder-icon"></span>
                            <strong>.pnpm/</strong> <span class="arrow">(hidden)</span>
                        </div>
                        <div class="folder">
                            <div class="folder-name">
                                <span class="icon folder-icon"></span>
                                express@4.18.0/node_modules/
                            </div>
                            <div class="folder">
                                <div class="folder-name">
                                    <span class="icon link-icon"></span>
                                    <span class="hardlink">express/</span>
                                    <span class="arrow">‚Üí store</span>
                                </div>
                                <div class="folder-name">
                                    <span class="icon link-icon"></span>
                                    <span class="hardlink">cookie/</span>
                                    <span class="arrow">‚Üí store</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="success">
                    ‚úÖ <strong>No Phantom Dependencies:</strong> Can only import packages explicitly listed in package.json
                </div>
                
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value">~100MB</div>
                        <div class="stat-label">Per Project</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">~300MB</div>
                        <div class="stat-label">10 Projects</div>
                    </div>
                </div>
                
                <div class="global-store">
                    <div class="store-title">
                        <span class="icon store-icon"></span>
                        Global Store (~/.pnpm-store/)
                    </div>
                    <div class="folder">
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">react@18.2.0</span>
                            <span class="arrow">‚Üê stored once!</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">express@4.18.0</span>
                        </div>
                        <div class="folder-name">
                            <span class="icon package-icon"></span>
                            <span class="actual-file">lodash@4.17.21</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; color: #28a745;">
                        All projects hard-link to this single store! üü¢
                    </div>
                </div>
            </div>
        </div>
        
        <h1>Using pnpm</h1>
        
        <div class="usage-section">
            <div class="usage-card">
                <h2 class="usage-title">Installation</h2>
                <div class="code-block">
                    <code>npm install -g pnpm</code>
                </div>
                <p class="usage-description">Install pnpm globally using npm, or use other methods like Homebrew on macOS.</p>
                <h2 class="usage-subtitle">Manage pnpm</h2>
                <div class="command-list">
                    <div class="command-item">
                        <code class="command">pnpm store prune</code>
                        <span class="command-desc">Remove unreferenced packages from store</span>
                    </div>
                    <div class="command-item">
                        <code class="command">pnpm store path</code>
                        <span class="command-desc">Show store location</span>
                    </div>
                </div>
            </div>
            
            <div class="usage-card">
                <h2 class="usage-title">Basic Commands</h2>
                <div class="command-list">
                    <div class="command-item">
                        <code class="command">pnpm install</code>
                        <span class="command-desc">Install dependencies</span>
                    </div>
                    <div class="command-item">
                        <code class="command">pnpm add &lt;package&gt;</code>
                        <span class="command-desc">Add a package</span>
                    </div>
                    <div class="command-item">
                        <code class="command">pnpm remove &lt;package&gt;</code>
                        <span class="command-desc">Remove a package</span>
                    </div>
                    <div class="command-item">
                        <code class="command">pnpm run &lt;script&gt;</code>
                        <span class="command-desc">Run a script</span>
                    </div>
                </div>
            </div>
            
            <div class="usage-card">
                <h2 class="usage-title">Migration from npm/yarn</h2>
                <div class="migration-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <p>Delete <code>node_modules</code> and <code>package-lock.json</code> (or <code>yarn.lock</code>)</p>
                        </div>
                    </div>
                    <div class="step">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <p>Run <code>pnpm install</code> to create <code>pnpm-lock.yaml</code></p>
                        </div>
                    </div>
                    <div class="step">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <p>Update CI/CD scripts to use pnpm commands</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="usage-card">
                <h2 class="usage-title">Key Features</h2>
                <ul class="feature-list">
                    <li>‚úÖ Works with any Node.js project</li>
                    <li>‚úÖ Compatible with npm registry</li>
                    <li>‚úÖ Supports monorepos with workspaces</li>
                    <li>‚úÖ Built-in support for peer dependencies</li>
                    <li>‚úÖ Automatic pruning of unused packages</li>
                </ul>
            </div>

            <div class="usage-card">
                <h2 class="usage-title">Monorepo Support</h2>
                <ul class="feature-list">
                    <li>‚úÖ Built-in workspace support with filtering</li>
                    <li>‚úÖ Run commands across multiple packages: <code>pnpm -r build</code></li>
                    <li>‚úÖ Shared dependencies across workspace packages</li>
                    <li>‚úÖ Better than npm workspaces or Lerna</li>
                </ul>
            </div>

            <div class="usage-card">
                <h2 class="usage-title">Production Benefits</h2>
                <ul class="feature-list">
                    <li>‚ö° <code>--frozen-lockfile</code> ensures exact reproduction</li>
                    <li>üì¶ 40% smaller Docker images with better layer caching</li>
                    <li>üöÄ <code>pnpm deploy</code> creates minimal production builds</li>
                    <li>üîí No phantom dependencies = no production surprises</li>
                    <li>üí∞ Faster CI builds = lower cloud costs</li>
                </ul>
                <div class="code-block">
                    <code>pnpm install --frozen-lockfile --prod</code>
                </div>
                <p class="usage-description">Production installs are deterministic and exclude devDependencies entirely.</p>
            </div>
        </div>
        
        <h1>Production Deployment with pnpm</h1>

        <div class="production-section">
            <div class="prod-card">
                <h2 class="prod-title">üì¶ The Build + Deploy Pattern</h2>
                
                <div class="build-deploy-explanation">                    
                    <div class="command-explanation">
                        <div class="command-block">
                            <code>pnpm install --frozen-lockfile</code>
                            <span class="command-purpose">‚Üí Installs EXACT dependencies for BUILD time</span>
                        </div>
                        <div class="command-block">
                            <code>pnpm build</code>
                            <span class="command-purpose">‚Üí Compiles YOUR code (TypeScript, React, etc.)</span>
                        </div>
                        <div class="command-block">
                            <code>pnpm deploy --prod ./output</code>
                            <span class="command-purpose">‚Üí Optimizes NODE_MODULES (removes 70-80% bloat)</span>
                        </div>
                    </div>
                    
                    <div class="benefit-section">
                        <h4 class="benefit-header">üéØ The pnpm Deploy Magic</h4>
                        <p>The command <code>pnpm deploy --prod ./output</code> creates a "perfect" production folder:</p>
                        <ul class="deploy-benefits">
                            <li>Strips out 70-80% of typical node_modules bloat</li>
                            <li>Converts all symlinks to real files (critical for Docker)</li>
                            <li>Removes every single dev dependency and their entire trees</li>
                            <li>Eliminates test files, docs, and TypeScript sources from packages</li>
                        </ul>
                        <p><strong>Example:</strong> A Next.js app's node_modules went from 1.2GB to 280MB using pnpm deploy.</p>
                    </div>

                    <div class="deploy-note">
                        <strong>Key insight:</strong> <code>--frozen-lockfile</code> ensures exact reproduction (CI fails fast if someone forgot to commit lock changes). <code>build</code> handles your code, <code>deploy</code> handles dependencies.
                    </div>
                </div>
            </div>

            <div class="prod-card">
                <h2 class="prod-title">üöÄ CI/CD & Docker Integration</h2>
                
                <div class="ci-docker-benefits">
                    <h3 class="ci-platform">Why pnpm Excels in CI/CD Pipelines</h3>

                    <div class="benefit-section">
                        <h4 class="benefit-header">üì¶ Docker Layer Optimization</h4>
                        <p>Traditional npm creates unpredictable node_modules structures - the same package.json can produce different layouts. This breaks Docker's layer caching.</p>
                        <p>pnpm's deterministic structure means Docker can reliably cache dependency layers. When you rebuild, only changed layers get rebuilt.</p>
                        <p><strong>The math:</strong> Base image (150MB) + pnpm deploy output (87MB) = 237MB total vs npm's typical 400MB+ images</p>
                    </div>

                    <div class="benefit-section">
                        <h4 class="benefit-header">üíæ Intelligent Caching Strategy</h4>
                        <p>Unlike npm's massive cache folder, pnpm's content-addressable store (at <code>~/.pnpm-store</code>) can be safely shared across all CI jobs and branches. One package version = one storage location, regardless of which project uses it.</p>
                        <p><strong>GitHub Actions tip:</strong> Cache the pnpm store path, not node_modules. This single cache works for ALL your repositories!</p>
                    </div>

                    <div class="benefit-section">
                        <h4 class="benefit-header">üîÑ Monorepo CI Superpowers</h4>
                        <p>In monorepos, pnpm can detect which packages changed and build only those: <code>pnpm --filter "...{origin/main}..." build</code></p>
                        <p>This means PRs that touch one service don't trigger builds for unrelated services. In a 20-service monorepo, this can cut CI time by 90%.</p>
                    </div>
                </div>
                
                <div class="ci-bottom-line">
                    <strong>Bottom Line:</strong> pnpm turns CI/CD from a bottleneck into a competitive advantage. Faster builds, smaller artifacts, and deterministic deploys mean you ship features, not fixes.
                </div>
            </div>
        </div>

        <h1>Considerations & Risks</h1>
        
        <div class="risks-section">
            <div class="risk-card warning-card">
                <h2 class="risk-title">‚ö†Ô∏è Mixed Package Manager Usage</h2>
                <p class="risk-description">If another developer runs <code>npm install</code> or <code>yarn install</code> on a pnpm project:</p>
                <ul class="risk-list">
                    <li>A <code>node_modules</code> folder with a different structure will be created</li>
                    <li>Both <code>pnpm-lock.yaml</code> and <code>package-lock.json</code>/<code>yarn.lock</code> will exist</li>
                    <li>Dependencies may resolve differently, causing inconsistent behavior</li>
                    <li>The project size will increase significantly due to duplicate packages</li>
                </ul>
                <div class="mitigation">
                    <strong>Mitigation:</strong> Add a <code>.npmrc</code> file with <code>engine-strict=true</code> and specify <code>packageManager</code> in <code>package.json</code>
                </div>
            </div>
            
            <div class="risk-card">
                <h2 class="risk-title">üîç Learning Curve & Team Adoption</h2>
                <ul class="risk-list">
                    <li>Team members need to install pnpm and learn new commands</li>
                    <li>Some developers may be unfamiliar with pnpm's strict dependency resolution</li>
                    <li>CI/CD pipelines need to be updated to use pnpm</li>
                    <li>Documentation and onboarding materials need updates</li>
                </ul>
            </div>
            
            <div class="risk-card">
                <h2 class="risk-title">üîß Tooling & Ecosystem Compatibility</h2>
                <ul class="risk-list">
                    <li>Some older tools may not work well with pnpm's symlink structure</li>
                    <li>Certain build tools may need configuration adjustments</li>
                    <li>Docker builds may require different strategies (copying <code>.pnpm</code> folder)</li>
                    <li>Some npm scripts that directly access <code>node_modules</code> may break</li>
                </ul>
            </div>
            
        </div>
        
        <h1>Preventing Mixed Package Manager Usage</h1>
        
        <div class="prevention-section">
            <div class="prevention-card">
                <div class="method-header">
                    <span class="method-number">1</span>
                    <h2 class="prevention-title">Use only-allow Package</h2>
                </div>
                
                <p class="prevention-description">The <code>only-allow</code> package forces developers to use a specific package manager by checking which command is being run.</p>
                
                <div class="setup-steps">
                    <div class="setup-step">
                        <h3>Installation</h3>
                        <div class="code-block">
                            <code>pnpm add -D only-allow</code>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>Add to package.json</h3>
                        <div class="code-block">
<pre><code>{
  "scripts": {
    "preinstall": "npx only-allow pnpm"
  }
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>What it does</h3>
                        <p>If someone runs <code>npm install</code> or <code>yarn install</code>, they'll see:</p>
                        <div class="code-block error-block">
<pre><code>Use "pnpm install" for installation in this project

If you don't have pnpm, install it via "npm i -g pnpm"</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="prevention-card">
                <div class="method-header">
                    <span class="method-number">2</span>
                    <h2 class="prevention-title">Configure .npmrc</h2>
                </div>
                
                <p class="prevention-description">Create a <code>.npmrc</code> file in your project root to enforce package manager usage through Node.js settings.</p>
                
                <div class="setup-steps">
                    <div class="setup-step">
                        <h3>Create .npmrc file</h3>
                        <div class="code-block">
<code>engine-strict=true</code>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>Update package.json</h3>
                        <div class="code-block">
<pre><code>{
  "engines": {
    "node": ">=18.0.0",
    "pnpm": ">=8.0.0",
    "npm": "please-use-pnpm",
    "yarn": "please-use-pnpm"
  },
  "packageManager": "pnpm@9.0.0"
}</code></pre>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>What it does</h3>
                        <p>With <code>engine-strict=true</code>, npm/yarn will fail with an error if they don't meet the engine requirements. The <code>packageManager</code> field is also recognized by Corepack.</p>
                    </div>
                </div>
            </div>
            
            <div class="prevention-card">
                <div class="method-header">
                    <span class="method-number">3</span>
                    <h2 class="prevention-title">Pre-commit Hooks (Husky)</h2>
                </div>
                
                <p class="prevention-description">Use Git hooks to prevent commits that include lock files from other package managers.</p>
                
                <div class="setup-steps">
                    <div class="setup-step">
                        <h3>Install Husky</h3>
                        <div class="code-block">
<pre><code>pnpm add -D husky
pnpm exec husky init</code></pre>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>Create pre-commit hook</h3>
                        <p>Edit <code>.husky/pre-commit</code>:</p>
                        <div class="code-block">
<pre><code>#!/bin/sh

if [ -f "package-lock.json" ]; then
  echo "‚ùå package-lock.json detected!"
  echo "Please use pnpm instead of npm"
  exit 1
fi

if [ -f "yarn.lock" ]; then
  echo "‚ùå yarn.lock detected!"
  echo "Please use pnpm instead of yarn"
  exit 1
fi</code></pre>
                        </div>
                    </div>
                    
                    <div class="setup-step">
                        <h3>Add to .gitignore</h3>
                        <div class="code-block">
<pre><code># Package manager locks (keep only pnpm)
package-lock.json
yarn.lock</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="recommendation-box">
            <h2>üéØ Recommended Approach</h2>
            <p>Use <strong>all three methods together</strong> for maximum protection:</p>
            <ol class="recommendation-list">
                <li><code>only-allow</code> provides immediate feedback when someone uses the wrong command</li>
                <li><code>.npmrc</code> configuration works as a backup and enables Corepack integration</li>
                <li>Pre-commit hooks prevent wrong lock files from being committed to the repository</li>
            </ol>
            <p>This layered approach ensures your team consistently uses pnpm without friction.</p>
        </div>
        
        <h1>Common Questions</h1>
        
        <div class="qa-card">
            <h2 class="qa-question">Can I still use <code>npm run</code>?</h2>
            <div class="qa-answer">
                <p><b>Yes!</b> You can still use <code>npm run &lt;script&gt;</code> even with pnpm installed - <b>as long as your script does not modify the dependencies in any way.</b></p>
            </div>
        </div>
    </div>
</body>
</html>